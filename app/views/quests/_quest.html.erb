<div class="post">
  <script type="text/javascript">
    $( function(){
      var $canvas = $(".progressbar-<%= quest.id %>");
      $canvas.attr('width', $canvas.parent().width())
      $canvas
      .drawText({
          fillStyle: '#FFF449',
          layer:'true',
          name: 'progtext',
          x: 290, y: 13,
          fontSize: 21,
          font: 'sans-serif',
          text: '<%= (@progresses[quest.id] * 100).to_i %>%達成中'
        });
      $canvas
      .animateLayer('bar', {
          width: <%= @progresses[quest.id] %> * $canvas.width()
        });
      <% if @progresses[quest.id] >= 1.0 %>
      $canvas
      .animateLayer('bar', {
          fillStyle: '#0090DD'
        });
      <% end %>

      <% if @progresses[quest.id] >= 1.0 %>
      $canvas.on('click', function(){
        $canvas.parent().remove();
      });
      <% end %>

      setInterval( function(){
        $(".limit-<%= quest.id %>").text(limitdate("<%= quest.created_at.tomorrow.to_s %>"));
      } , 1000);
    });

  </script>
  <div class="content content-<%= quest.id %>">
    <%= p quest.to_s %>
  </div>
  <canvas class="progressbar progressbar-<%= quest.id %>" width="420" height="40"></canvas>
  <div class="limit limit-<%= quest.id %>">残り 00:00:00</div>
</div>
